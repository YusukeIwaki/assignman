### **データベースの主要なテーブル（エンティティ）**

サービスの要件を実現するために、以下の概念を表すテーブルを設計します。

#### **1\. 組織 (Organizations)**

* **目的**: 顧客となる企業や団体ごとデータを分離し、管理するための最上位の入れ物です 1。これにより、複数の企業が同じシステムを安全に利用できる状態（マルチテナント）を実現します。

* **主な構造**:  
  * **組織名**: 登録された企業や部署を識別するための名前。

#### **2\. ユーザー (Users)**

* **目的**: システム内でのユーザー識別のためのコアエンティティです。認証情報や公開プロフィール情報は分離されています。

* **主な構造**:  
  * **ID**: プライマリキー  
  * **所属組織**: どの組織に属するユーザーかを示す情報  
  * **作成日時・更新日時**: レコードのタイムスタンプ

#### **2-1\. ユーザー認証情報 (UserCredentials)**

* **目的**: ユーザーのログイン認証に必要な機密情報を管理します。認可（権限）情報は含まず、純粋に認証のためのデータのみを扱います。

* **主な構造**:  
  * **ユーザー参照**: どのユーザーの認証情報かを示すID  
  * **メールアドレス**: ログインに使用する識別子（一意制約）  
  * **パスワードダイジェスト**: ハッシュ化されたパスワード  
  * **作成日時・更新日時**: レコードのタイムスタンプ

* **設計思想**: 認証（Authentication）と認可（Authorization）を分離。権限情報は別モデルで管理することで、複雑な権限システムを柔軟に実装可能にします。

#### **2-2\. ユーザープロフィール (UserProfiles)**

* **目的**: ユーザーの公開可能なプロフィール情報を管理します。認証情報とは分離され、表示やキャッシュに最適化できます。

* **主な構造**:  
  * **ユーザー参照**: どのユーザーのプロフィールかを示すID  
  * **表示名**: システム内で表示される名前  
  * **自己紹介文**: オプションの説明文  
  * **アバターURL**: プロフィール画像のURL（オプション）  
  * **作成日時・更新日時**: レコードのタイムスタンプ

#### **3\. メンバー (Members)**

* **目的**: プロジェクトにアサインされる「人的リソース」のプロフィール情報を管理します 4。これはシステムにログインする「ユーザー」とは別の概念です 5。これにより、ログイン権限を持たない外部パートナーなども管理対象に含められます 6。

* **主な構造**:  
  * **所属組織**: どの組織に属するメンバーかを示す情報。  
  * **名前**: メンバーを識別するための氏名。  
  * **役割**: 「エンジニア」や「デザイナー」といった、そのメンバーの主要な職務 7。

  * **稼働キャパシティ**: そのメンバーが標準でどれくらいの業務量（例: 100%）をこなせるかを示す基準値 8。

#### **4\. プロジェクト (Projects)**

* **目的**: 開始日と終了日を持つ、独立した仕事の単位を管理します 9。アサインの対象となる業務コンテナです。

* **主な構造**:  
  * **所属組織**: どの組織のプロジェクトかを示す情報。  
  * **プロジェクト名**: プロジェクトを識別するための名前。  
  * **期間**: プロジェクトの開始日と終了日。  
  * **ステータス**: 「未確定」「確定」「アーカイブ」といった、プロジェクトの進行状況 10。

#### **5\. アサイン (Assignments)**

* **目的**: 「どのメンバー」を「どのプロジェクト」に、「いつからいつまで」「どれくらいの比重で」割り当てるかを記録する、システムの中核となる情報です 11。

* **主な構造**:  
  * **対象プロジェクト**: どのプロジェクトへの割り当てかを示す情報 12。

  * **担当メンバー**: どのメンバーを割り当てるかを示す情報 13。

  * **期間**: アサインの開始日と終了日。  
  * **アサイン率**: その期間中、メンバーの稼働キャパシティのうち何%をこのプロジェクトに割り当てるかを示す数値 14。

#### **6\. 役割 (Roles) と スキル (Skills)**

* **目的**: メンバーの属性を構造化するためのマスターデータです。「役割」はメンバーの職務（例: エンジニア）を 15、「スキル」は特定の専門技能（例: Python）を表します 16。これらにより、高度なリソース検索が可能になります。

* **主な構造**:  
  * **所属組織**: どの組織で定義された役割・スキルかを示す情報。  
  * **名称**: 「エンジニア」や「Python」といった役割・スキルの名前。

#### **7\. メンバースキル (MemberSkills)**

* **目的**: 一人の「メンバー」が複数の「スキル」を持つという関係（多対多）を実現するための、両者をつなぐ中間的なテーブルです。  
* **主な構造**:  
  * **対象メンバー**: どのメンバーかを示す情報。  
  * **対象スキル**: どのスキルかを示す情報。

---

### **エンティティ関連（リレーションシップ）**

上記の各テーブル（概念）は、以下のように相互に関連します。

* **プロジェクト**は、多数の**アサイン**を持つことができます 17。

* **メンバー**もまた、多数の**アサイン**を持つことができます 18。

* 一つの  
  **アサイン**は、必ず一つの**プロジェクト**と一人の**メンバー**に紐付きます 19。

* 一人の  
  **メンバー**は、一つの主要な**役割**を持ち 20、多数の

  **スキル**を持つことができます 21。

* **組織**は、その組織に属する全ての**ユーザー**、**メンバー**、**プロジェクト**、**役割**、**スキル**を保有します 22。

---

### **クエリ設計に関する考慮事項**

このデータベース構造は、以下の重要な業務ロジックを効率的に処理するために不可欠です。

* **メンバーの稼働率計算**: 特定の期間において、各メンバーに紐づく全ての**アサイン**情報を集計し、**アサイン率**を合算する必要があります。  
* **オーバーアロケーションの検出**: 新しい**アサイン**が追加・変更された際、メンバーの**アサイン率**の合計が、そのメンバーの持つ**稼働キャパシティ**（例: 100%）を超過する日がないかをチェックする必要があります 23。

* **リソースの空き状況検索**: 「特定の**スキル**を持ち、かつ指定期間内の**アサイン率**が一定以下の**メンバー**」といった高度な検索要件に応える必要があります 24。これは、複数のテーブルをまたいだ複雑なデータ検索が求められることを意味します。  



### ドメインモデルの整理

フィードバックを反映し、各概念を独立したドメインモデルとして定義します。

* **管理者 (Administrator)**
    * プロジェクトの計画策定やメンバーのアサインを行うアクターです。

* **メンバー (Member)**
    * プロジェクトにアサインされるリソースであり、自身の確定したスケジュールを閲覧するアクターです。

* **通常プロジェクト (StandardProject)**
    * 明確な期間と目的を持つ、一般的なプロジェクトです。
    * **主な属性**: プロジェクト名、開始日、終了日

* **定常プロジェクト (OngoingProject)**
    * 決まった終了日がなく、継続的に発生する業務を表します。
    * **主な属性**: プロジェクト名

* **ラフプロジェクトアサイン (RoughProjectAssignment)**
    * **管理者**が**通常プロジェクト**の全体計画を策定するために使用する、仮のアサイン情報です。**メンバー**には公開されません。
    * **主な属性**: 対象の通常プロジェクト、対象メンバー、開始日、終了日、アサイン割合(%)

* **詳細プロジェクトアサイン (DetailedProjectAssignment)**
    * **ラフプロジェクトアサイン**を基に**管理者**が確定させ、**メンバー**に通知するための正式なアサイン情報です。
    * **主な属性**: 対象の通常プロジェクト、対象メンバー、開始日、終了日、アサイン割合(%)

* **定常アサイン (OngoingAssignment)**
    * **定常プロジェクト**に対して**メンバー**を割り当てるためのアサイン情報です。これは計画段階を経ず、確定情報として扱われます。
    * **主な属性**: 対象の定常プロジェクト、対象メンバー、開始日、終了日（任意）、週ごとのアサイン割合(%)

---

### ユースケースの厳密な表現

分割したドメインモデルを用いて、ユースケースをより厳密に表現します。

* **ユースケース1: プロジェクト全体計画の策定**
    * **アクター**: **管理者**
    * **トリガー**: **管理者**が**通常プロジェクト**の初期計画を立てる時。
    * **概要**: **管理者**は、対象の**通常プロジェクト**に対して、複数の**メンバー**の稼働を**ラフプロジェクトアサイン**としてシステムに登録する。この時点では、この計画は**管理者**のみ閲覧可能であり、**メンバー**は認知しない。

* **ユースケース2: メンバーへのアサインの確定と通知**
    * **アクター**: **管理者**
    * **トリガー**: **管理者**が**ラフプロジェクトアサイン**の内容を承認し、**メンバー**に正式な業務として割り当てる時。
    * **概要**: **管理者**は、一つまたは複数の**ラフプロジェクトアサイン**を選択し、それを確定させる。この操作により、システムは対応する**詳細プロジェクトアサイン**を作成または更新する。この**詳細プロジェクトアサイン**が作成された時点で、アサイン対象の**メンバー**は自身のスケジュールとして閲覧可能になる。

* **ユースケース3: 定常業務の割り当て**
    * **アクター**: **管理者**
    * **トリガー**: **管理者**が**メンバー**を継続的な業務に割り当てる時。
    * **概要**: **管理者**は、対象の**定常プロジェクト**と**メンバー**を選択し、**定常アサイン**を作成する。このアサインは即時に確定情報として扱われ、対象**メンバー**は自身のスケジュールとして閲覧可能になる。

* **ユースケース4: 自身の確定スケジュールの確認**
    * **アクター**: **メンバー**
    * **トリガー**: **メンバー**が自身の稼働予定を確認する時。
    * **概要**: システムは、ログインしている**メンバー**に紐づく全ての**詳細プロジェクトアサイン**および**定常アサイン**を検索する。**メンバー**はこれらの確定したアサイン情報のみを、週単位または月単位で集計されたカレンダー形式で確認できる。**ラフプロジェクトアサイン**は表示されない。